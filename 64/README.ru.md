# Конкурс красивого кода SBER

Проект для конкурса: https://beautifulcode.ru/task/frontend#rules

Приложение предоставляет способ управления личным бюджетом:

- просмотр транзакций
- просмотр графиков расходов
- добавление транзакций
- удаление транзакций
- редактирование транзакций

Github: https://github.com/MrCelestis/sber-contest-2024

Demo деплой (интеграция с сервером частичная):

https://sber-contest-2024-ui.vercel.app/
https://sber-contest-2024-ui.vercel.app/ru (русский перевод)

## Настройка

Установите зависимости (Node 18):

```bash
npm install
```

## Сервер разработки

Запустите сервер разработки (nuxt хост приложения) на `http://localhost:3000`:

```bash
npm run dev
```

## Mock серверы

В приложении есть 2 имитационных сервера (и 3-й для тестов e2e).

### Mock сервер nitro

Mock сервер Nitro используется в демонстрационных средах, которые не позволяют получить доступ к внешнему API со стороны сервера Nuxt (используется в SSR). По умолчанию он также запускается в режиме разработки.

Использование этого сервера настраивается с помощью `nuxt.config.runtimeConfig.public.apiBase: '/api/'` (по умолчанию). Абсолютный URL используется для развертывания на Vercel.

Этот сервер использует in-memory хранилище и при перезапуске потеряет ваши данные.
На Vercel данные НЕ будут сохраняться между сессиями, это только для демонстрационных целей.

Сервер использует сгенерированный `large-db.json` (см. ниже) и также может отвечать с помощью переведенных категорий из `category-names.ru.json`.

### json-server

Mock данные (метаданные категории расходов и транзакции) могут быть использованы для
разработки с использованием mock сервера с использованием json-server (порт 3001):

```bash
npm run mock-server:start
```

Чтобы использовать его, вам нужно установить значение `nuxt.config.runtimeConfig.public.apiBase: 'http://localhost:3001'`

Команда запускает json-server, поддерживающий основные CRUD операции для сущностей по следующим путям:

- http://localhost:3001/category-metadata
- http://localhost:3001/transactions

Сервер можно использовать с большим набором данных, имитирующим долгосрочное использование:

```bash
npm run mock-server:start:large
```

Файл данных для режима 'large' автоматически генерируется после установки пакета NPM, но его
можно сгенерировать повторно с использованием

```bash
npm run mock-server:gen-large-db
```

Метаданные категории расходов включают URL-адреса иконок в формате data-URL, но поддерживают
любой допустимый путь. Приложение предполагает, что эти значки черные.

## Production

Production сборка:

```bash
npm run build
```

Локальный production просмотр:

```bash
npm run preview
```

## Обзор приложения

Приложение состоит из карточек на одной странице. Использована адаптивная вёрстка, меняющая расположение карточек в зависимости от размера экрана.

### Краткий перечень использованных технологий и библиотек

- Приложение написано на Nuxt 3 с поддержкой SSR.
- PrimeVue использован в качестве UI библиотеки и для виртуального скрола.
- Pinia использована для сторов, чтобы централизировать логику приложения и переиспользовать вычисления.
- ChartJS использован для отображения графиков.
- Стили написаны на SCSS с BEM именованием.
- Библиотека i18n использована для переводов.
- Тесты написаны на Vitest и Playwright.

### Заголовок

Заголовок содержит фильтр транзакций с 3 режимами: Месяц, Год и Даты.

Пользователь может переключаться между режимами с помощью кнопок + соседние Месяц и Год можно выбрать с помощью кнопок со стрелками. Пользовательский интервал можно настроить в селекторе дат.

### Область графиков

Область графиков содержит 2 представления для аналитики: кольцевую диаграмму категорий и линейную диаграмму истории баланса, пользователь может переключаться между ними с помощью кнопок со стрелками.

График категорий показывает несколько наиболее часто используемых категорий (кол-во настраивается в конфигурации) и группирует остальные в категории «Другое».

Эти категории показаны под графиком для быстрой фильтрации.

Итоговые суммы расходов отображаются в центре графика категорий.

### Итоги

Карточка итогов показывает обзор общих расходов, доходов и баланса.

Она является глобальной и не зависит от фильтра категорий в области графика.

### Карточка транзакций

Карточка транзакций показывает отфильтрованные транзакции в списке с поддержкой виртуальной прокрутки, поэтому он может обрабатывать множество элементов без проблем с пользовательским опытом.

Пользователь может выбрать способ отображения транзакций: сгруппированные по дате или в виде плоского списка, отсортированного по абсолютной сумме транзакции.

Здесь пользователь также может добавить новую транзакцию или отредактировать/удалить любую существующую.

### Ограничения данных

Несмотря на наличие виртуальной прокрутки, есть настраиваемый предел
для количества транзакций: пользователю будет показана ошибка, если их будет слишком много. Это сделано, чтобы избежать потенциальных проблем с производительностью из-за скриптов, но этот предел по умолчанию довольно большой, и разумное использование приложения не приведет к превышению этого предела.

Ограничения на категории нет, поскольку слишком большое количество может перегрузить  восприятие пользователя, и такое использование нежелательно.

### Загрузка данных и кэширование

Приложение кэширует запрос метаданных категорий и никогда не запускает его повторно.

Транзакции запрашиваются с фильтом по timestamp, соответствующим выбранному интервалу.
Timestamp считается UTC epoch датой без времени, они форматируются как локальная дата.
Транзакции запрашиваются с API с сортировкой по времени.

Запросы транзакций кэшируются с использованием кэша Least Recently Used, количество записей
настраивается (по умолчанию 5).

Изменение списка транзакций любым способом инвалидирует запросы с пересекающимися интервалами, тем самым выполняя их снова.

### SSR

Приложение создано с использованием nuxt и поддерживает server-side rendering.
Cookie используются для хранения постоянных пользовательских настроек, таких как настройки фильтров, эти cookie используются на сервере для применения состояния и запуска начального запроса транзакций перед отправкой ресурсов клиенту.

### Lazy loading

Большая часть приложения загружается немедленно, поскольку она всегда видна.
Диалоговое окно изменения транзакции загружается по требованию.

### Темный режим

Приложение автоматически определяет темный режим и переключает стили соответствующим образом.

### Локализация

Весь предопределенный текст в приложении использует i18n для переводов.

Язык по умолчанию — английский; русский доступен по URL `/ru` (например, http://localhost:3000/ru).

Заголовок 'Accept-Language' отправляется приложением для запроса перевода предпочитаемой категории.
Mock сервер, использующий json-server, не поддерживает переводы категорий, но mock сервер nitro (запускается в режиме разработки) отвечает с переводами в зависимости от этого заголовка.

### Тесты unit и component

Для запуска тестов модулей и компонентов nuxt через vitest используйте

```bash
npm run test
```

### End-to-end тесты

Для запуска тестов e2e вам нужно инициализировать playwright с помощью

```bash
npx playwright install
```

а затем запустить тесты через

```bash
npm run e2e
```
Для использования Playwright UI запустите с опцией ui:

```bash
npm run e2e:ui
```